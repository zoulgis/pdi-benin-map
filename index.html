<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="css/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/MarkerCluster.css">
        <link rel="stylesheet" href="css/MarkerCluster.Default.css">
        <link rel="stylesheet" href="css/leaflet-control-geocoder.Geocoder.css">
        <link rel="stylesheet" href="css/leaflet-measure.css">
        <style>
#toggle-stats-panel {
  position: absolute;
  top: 25px; /* en dessous des boutons de zoom */
  left: 45px; /* l√©g√®rement d√©cal√© vers la droite */
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 8px 10px;
  cursor: pointer;
  z-index: 1200;
  font-size: 16px;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.2);
  transition: background-color 0.2s ease;
}


#toggle-stats-panel:hover {
  background-color: #0056b3;
}
        html, body, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #info-box {
  position: absolute;
  bottom: 10px;
  left: 10px;
  background-color: rgba(255,255,255,0.9);
  padding: 10px 15px;
  border-radius: 6px;
  font-size: 13px;
  max-width: 300px;
  z-index: 1000;
  box-shadow: 0 0 5px rgba(0,0,0,0.3);
}

#stats-hover-zone {
  position: absolute;
  top: 0;
  left: 0;
  width: 20px;
  height: 100%;
  z-index: 1099;
}

#stats-panel.show {
  left: 0;
}

.chart {
  width: 100%;
  height: 200px;
  margin-bottom: 20px;
}

#stats-panel {
  position: absolute;
  top: 0;
  left: -340px;
  width: 320px;
  height: 100%;
  background-color: #2fecd0e1;
  box-shadow: 4px 0 12px rgba(0, 0, 0, 0.2);
  z-index: 1100;
  padding: 15px 18px;
  overflow-y: auto;
  transition: left 0.3s ease;
  font-family: 'Segoe UI', sans-serif;
}

#stats-panel.show {
  left: 0;
}

#stats-panel h3 {
  font-size: 18px;
  margin-bottom: 15px;
  color: #333;
  text-align: center;
}

#stats-panel label {
  font-weight: 600;
  font-size: 14px;
  margin-top: 10px;
  display: block;
  color: #444;
}

#stats-panel select {
  width: 100%;
  padding: 5px 8px;
  margin-top: 3px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background-color: #f9f9f9;
  font-size: 13px;
}

.chart {
  width: 100%;
  height: 220px;
  margin-bottom: 25px;
  background: #fff;
  padding: 8px;
  border-radius: 10px;
  box-shadow: 0 0 8px rgba(0,0,0,0.06);
}

#top-communes {
  font-size: 13px;
  padding: 10px;
  background-color: #fafafa;
  border-radius: 8px;
  border: 1px solid #eee;
  margin-bottom: 20px;
  line-height: 1.5;
}

#top-communes strong {
  display: block;
  margin-bottom: 8px;
  color: #333;
}
.leaflet-control-attribution {
  font-size: 12px !important;
  color: #333;
  background-color: rgba(255, 255, 255, 0.85);
  padding: 4px 10px;
  border-radius: 6px;
  font-weight: 500;
}

        </style>
        <title>Cartographie Dynamique des PDI du B√©nin</title>
    </head>
    <body>
        <div id="map">
<div id="stats-hover-zone"></div>
<div id="stats-panel">
  <h3>üìä Statistiques PDI</h3>

  <div class="filter-section">
    <label>üìå D√©partement</label>
    <select id="select-dept"></select>

    <label>üèòÔ∏è Commune</label>
    <select id="select-commune"></select>

    <label>üìç Localit√©</label>
    <select id="select-localite"></select>
  </div>

  <div id="top-communes"></div>

  <canvas id="genderChart" class="chart"></canvas>
  <canvas id="causeChart" class="chart"></canvas>
  <canvas id="dateChart" class="chart"></canvas>
</div>



            <div id="info-box">
  <strong>üìå Description</strong><br>
  Cette cartographie dynamique pr√©sente une visualisation interactive des Personnes D√©plac√©es Internes (PDI) au B√©nin √† diff√©rentes √©chelles administratives (D√©partement, Commune, Arrondissement, Localit√©).<br><br>
  ‚ö†Ô∏è <strong>Important</strong> : Les donn√©es utilis√©es ici sont enti√®rement <strong>fictives</strong> et servent uniquement √† des fins <em>illustratives</em> ou p√©dagogiques.
</div>

        </div>
        <script src="js/qgis2web_expressions.js"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/L.Control.Layers.Tree.min.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet-control-geocoder.Geocoder.js"></script>
        <script src="js/leaflet-measure.js"></script>
        <script src="js/leaflet.markercluster.js"></script>
        <script src="data/arrondissemeetude_1.js"></script>
        <script src="data/communenationale_2.js"></script>
        <script src="data/basepdi_3.js"></script>
        <script src="data/departementnational_4.js"></script>
        <script>
       var bounds = [[4.5, -1.0], [14.0, 5.5]];  // Limites du B√©nin

var map = L.map('map', {
    zoomControl: false,
    maxZoom: 12,        // facultatif : limite le zoom avant
    minZoom: 5,         // facultatif : limite le zoom arri√®re
    maxBounds: bounds,  // emp√™che de sortir du B√©nin
    maxBoundsViscosity: 1.0  // effet "√©lastique" √† 100%
});
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix(
  '‚ú® Carte interactive cr√©√©e par <strong>Zoul-yadeini TABE</strong> | üìå Propuls√©e par <a href="https://leafletjs.com" target="_blank">Leaflet</a> & <a href="https://qgis.org" target="_blank">QGIS</a>'
);

        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});
        // remove popup's row if "visible-with-data"
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        // add class to format popup if it contains media
		function addClassToPopupIfMedia(content, popup) {
			var tempDiv = document.createElement('div');
			tempDiv.innerHTML = content;
			if (tempDiv.querySelector('td img')) {
				popup._contentNode.classList.add('media');
					// Delay to force the redraw
					setTimeout(function() {
						popup.update();
					}, 10);
			} else {
				popup._contentNode.classList.remove('media');
			}
		}
        var title = new L.Control({'position':'topright'});
        title.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;
        };
        title.update = function () {
            this._div.innerHTML = '<h2>Cartographie Dynamique des PDI du B√©nin</h2>';
        };
        title.addTo(map);
        var zoomControl = L.control.zoom({
            position: 'topleft'
        }).addTo(map);
        var measureControl = new L.Control.Measure({
            position: 'topleft',
            primaryLengthUnit: 'meters',
            secondaryLengthUnit: 'kilometers',
            primaryAreaUnit: 'sqmeters',
            secondaryAreaUnit: 'hectares'
        });
        measureControl.addTo(map);
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].innerHTML = '';
        document.getElementsByClassName('leaflet-control-measure-toggle')[0].className += ' fas fa-ruler';
        var bounds_group = new L.featureGroup([]);
        function setBounds() {
            if (bounds_group.getLayers().length) {
                map.fitBounds(bounds_group.getBounds());
            }
        }
        map.createPane('pane_OpenStreetMap_0');
        map.getPane('pane_OpenStreetMap_0').style.zIndex = 400;
        var layer_OpenStreetMap_0 = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            pane: 'pane_OpenStreetMap_0',
            opacity: 1.0,
            attribution: '',
            minZoom: 1,
            maxZoom: 28,
            minNativeZoom: 0,
            maxNativeZoom: 19
        });
        layer_OpenStreetMap_0;
        map.addLayer(layer_OpenStreetMap_0);
        function pop_arrondissemeetude_1(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['ARRONDISSE'] !== null ? autolinker.link(String(feature.properties['ARRONDISSE']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Total_PDI</th>\
                        <td>' + (feature.properties['Total_PDI'] !== null ? autolinker.link(String(feature.properties['Total_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_H_PDI</th>\
                        <td>' + (feature.properties['Sexe_H_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_H_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_F_PDI</th>\
                        <td>' + (feature.properties['Sexe_F_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_F_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_arrondissemeetude_1_0(feature) {
            if (feature.properties['Total_PDI'] >= 23.000000 && feature.properties['Total_PDI'] <= 181.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,131,186,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 181.000000 && feature.properties['Total_PDI'] <= 330.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(116,182,173,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 330.000000 && feature.properties['Total_PDI'] <= 505.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,226,168,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 505.000000 && feature.properties['Total_PDI'] <= 719.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(231,245,183,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 719.000000 && feature.properties['Total_PDI'] <= 944.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(254,232,164,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 944.000000 && feature.properties['Total_PDI'] <= 1438.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,186,110,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 1438.000000 && feature.properties['Total_PDI'] <= 2332.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(237,110,67,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 2332.000000 && feature.properties['Total_PDI'] <= 3175.000000 ) {
                return {
                pane: 'pane_arrondissemeetude_1',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(215,25,28,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_arrondissemeetude_1');
        map.getPane('pane_arrondissemeetude_1').style.zIndex = 401;
        map.getPane('pane_arrondissemeetude_1').style['mix-blend-mode'] = 'normal';
        var layer_arrondissemeetude_1 = new L.geoJson(json_arrondissemeetude_1, {
            attribution: '',
            interactive: true,
            dataVar: 'json_arrondissemeetude_1',
            layerName: 'layer_arrondissemeetude_1',
            pane: 'pane_arrondissemeetude_1',
            onEachFeature: pop_arrondissemeetude_1,
            style: style_arrondissemeetude_1_0,
        });
        bounds_group.addLayer(layer_arrondissemeetude_1);
        map.addLayer(layer_arrondissemeetude_1);
        function pop_communenationale_2(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NAME1_'] !== null ? autolinker.link(String(feature.properties['NAME1_']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Total_PDI</th>\
                        <td>' + (feature.properties['Total_PDI'] !== null ? autolinker.link(String(feature.properties['Total_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_H_PDI</th>\
                        <td>' + (feature.properties['Sexe_H_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_H_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_F_PDI</th>\
                        <td>' + (feature.properties['Sexe_F_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_F_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_communenationale_2_0(feature) {
            if (feature.properties['Total_PDI'] >= 84.000000 && feature.properties['Total_PDI'] <= 260.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,131,186,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 260.000000 && feature.properties['Total_PDI'] <= 441.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(116,182,173,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 441.000000 && feature.properties['Total_PDI'] <= 754.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(183,226,168,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 754.000000 && feature.properties['Total_PDI'] <= 1074.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(231,245,183,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 1074.000000 && feature.properties['Total_PDI'] <= 2389.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(254,232,164,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 2389.000000 && feature.properties['Total_PDI'] <= 3365.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,186,110,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 3365.000000 && feature.properties['Total_PDI'] <= 6029.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(237,110,67,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 6029.000000 && feature.properties['Total_PDI'] <= 9709.000000 ) {
                return {
                pane: 'pane_communenationale_2',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(215,25,28,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_communenationale_2');
        map.getPane('pane_communenationale_2').style.zIndex = 402;
        map.getPane('pane_communenationale_2').style['mix-blend-mode'] = 'normal';
        var layer_communenationale_2 = new L.geoJson(json_communenationale_2, {
            attribution: '',
            interactive: true,
            dataVar: 'json_communenationale_2',
            layerName: 'layer_communenationale_2',
            pane: 'pane_communenationale_2',
            onEachFeature: pop_communenationale_2,
            style: style_communenationale_2_0,
        });
        bounds_group.addLayer(layer_communenationale_2);
        map.addLayer(layer_communenationale_2);
        function pop_basepdi_3(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2"><strong>Localit√©</strong><br />' + (feature.properties['Localit√©'] !== null ? autolinker.link(String(feature.properties['Localit√©']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Nb_PDI</th>\
                        <td>' + (feature.properties['Nb_PDI'] !== null ? autolinker.link(String(feature.properties['Nb_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_H</th>\
                        <td>' + (feature.properties['Sexe_H'] !== null ? autolinker.link(String(feature.properties['Sexe_H']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_F</th>\
                        <td>' + (feature.properties['Sexe_F'] !== null ? autolinker.link(String(feature.properties['Sexe_F']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Cause</th>\
                        <td>' + (feature.properties['Cause'] !== null ? autolinker.link(String(feature.properties['Cause']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Date_arriv</th>\
                        <td>' + (feature.properties['Date_arriv'] !== null ? autolinker.link(String(feature.properties['Date_arriv']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_basepdi_3_0(feature) {
            switch(String(feature.properties['Cause'])) {
                case 'Autre conflit':
                    return {
                pane: 'pane_basepdi_3',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(117,58,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(26,216,150,1.0)',
                interactive: true,
            }
                    break;
                case 'Conflit arm√©':
                    return {
                pane: 'pane_basepdi_3',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(117,58,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(162,76,211,1.0)',
                interactive: true,
            }
                    break;
                case 'Inondation':
                    return {
                pane: 'pane_basepdi_3',
                radius: 4.0,
                opacity: 1,
                color: 'rgba(117,58,128,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 2.0,
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(210,164,84,1.0)',
                interactive: true,
            }
                    break;
            }
        }
        map.createPane('pane_basepdi_3');
        map.getPane('pane_basepdi_3').style.zIndex = 403;
        map.getPane('pane_basepdi_3').style['mix-blend-mode'] = 'normal';
        var layer_basepdi_3 = new L.geoJson(json_basepdi_3, {
            attribution: '',
            interactive: true,
            dataVar: 'json_basepdi_3',
            layerName: 'layer_basepdi_3',
            pane: 'pane_basepdi_3',
            onEachFeature: pop_basepdi_3,
            pointToLayer: function (feature, latlng) {
                var context = {
                    feature: feature,
                    variables: {}
                };
                return L.circleMarker(latlng, style_basepdi_3_0(feature));
            },
        });
        var cluster_basepdi_3 = new L.MarkerClusterGroup({showCoverageOnHover: false,
            spiderfyDistanceMultiplier: 2});
        cluster_basepdi_3.addLayer(layer_basepdi_3);

        bounds_group.addLayer(layer_basepdi_3);
        cluster_basepdi_3.addTo(map);
        function updateClusterVisibility() {
    if (map.getZoom() > 9) {
        map.removeLayer(cluster_basepdi_3);
        map.addLayer(layer_basepdi_3); // couches individuelles
    } else {
        map.removeLayer(layer_basepdi_3);
        map.addLayer(cluster_basepdi_3);
    }
}
map.on("zoomend", updateClusterVisibility);
updateClusterVisibility();

        function pop_departementnational_4(feature, layer) {
            var popupContent = '<table>\
                    <tr>\
                        <td colspan="2">' + (feature.properties['NAME1_'] !== null ? autolinker.link(String(feature.properties['NAME1_']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Total_PDI</th>\
                        <td>' + (feature.properties['Total_PDI'] !== null ? autolinker.link(String(feature.properties['Total_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_H_PDI</th>\
                        <td>' + (feature.properties['Sexe_H_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_H_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                    <tr>\
                        <th scope="row">Sexe_F_PDI</th>\
                        <td>' + (feature.properties['Sexe_F_PDI'] !== null ? autolinker.link(String(feature.properties['Sexe_F_PDI']).replace(/'/g, '\'').toLocaleString()) : '') + '</td>\
                    </tr>\
                </table>';
            var content = removeEmptyRowsFromPopupContent(popupContent, feature);
			layer.on('popupopen', function(e) {
				addClassToPopupIfMedia(content, e.popup);
			});
			layer.bindPopup(content, { maxHeight: 400 });
        }

        function style_departementnational_4_0(feature) {
            if (feature.properties['Total_PDI'] >= 390.000000 && feature.properties['Total_PDI'] <= 390.000000 ) {
                return {
                pane: 'pane_departementnational_4',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(43,131,186,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 390.000000 && feature.properties['Total_PDI'] <= 1190.000000 ) {
                return {
                pane: 'pane_departementnational_4',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(171,221,164,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 1190.000000 && feature.properties['Total_PDI'] <= 2524.000000 ) {
                return {
                pane: 'pane_departementnational_4',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(255,255,191,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 2524.000000 && feature.properties['Total_PDI'] <= 15909.000000 ) {
                return {
                pane: 'pane_departementnational_4',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(253,174,97,1.0)',
                interactive: true,
            }
            }
            if (feature.properties['Total_PDI'] >= 15909.000000 && feature.properties['Total_PDI'] <= 34276.000000 ) {
                return {
                pane: 'pane_departementnational_4',
                opacity: 1,
                color: 'rgba(35,35,35,1.0)',
                dashArray: '',
                lineCap: 'butt',
                lineJoin: 'miter',
                weight: 1.0, 
                fill: true,
                fillOpacity: 1,
                fillColor: 'rgba(215,25,28,1.0)',
                interactive: true,
            }
            }
        }
        map.createPane('pane_departementnational_4');
        map.getPane('pane_departementnational_4').style.zIndex = 404;
        map.getPane('pane_departementnational_4').style['mix-blend-mode'] = 'normal';
        var layer_departementnational_4 = new L.geoJson(json_departementnational_4, {
            attribution: '',
            interactive: true,
            dataVar: 'json_departementnational_4',
            layerName: 'layer_departementnational_4',
            pane: 'pane_departementnational_4',
            onEachFeature: pop_departementnational_4,
            style: style_departementnational_4_0,
        });
        bounds_group.addLayer(layer_departementnational_4);
        map.addLayer(layer_departementnational_4);
        var osmGeocoder = new L.Control.Geocoder({
            collapsed: true,
            position: 'topleft',
            text: 'Search',
            title: 'Testing'
        }).addTo(map);
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .className += ' fa fa-search';
        document.getElementsByClassName('leaflet-control-geocoder-icon')[0]
        .title += 'Search for a place';
        var overlaysTree = [
            {label: 'üìç <strong>Densit√© de PDI par d√©partement</strong><br /><table><tr><td style="text-align: center;"><img src="legend/departementnational_4_3903900.png" /></td><td>390 - 390</td></tr><tr><td style="text-align: center;"><img src="legend/departementnational_4_39011901.png" /></td><td>390 - 1190</td></tr><tr><td style="text-align: center;"><img src="legend/departementnational_4_119025242.png" /></td><td>1190 - 2524</td></tr><tr><td style="text-align: center;"><img src="legend/departementnational_4_2524159093.png" /></td><td>2524 - 15909</td></tr><tr><td style="text-align: center;"><img src="legend/departementnational_4_15909342764.png" /></td><td>15909 - 34276</td></tr></table>', layer: layer_departementnational_4},
            {label: 'üß≠ <strong>Causes de d√©placement des PDI</strong><br /><table><tr><td style="text-align: center;"><img src="legend/basepdi_3_Autreconflit0.png" /></td><td>Autre conflit</td></tr><tr><td style="text-align: center;"><img src="legend/basepdi_3_Conflitarm√©1.png" /></td><td>Conflit arm√©</td></tr><tr><td style="text-align: center;"><img src="legend/basepdi_3_Inondation2.png" /></td><td>Inondation</td></tr></table>', layer: cluster_basepdi_3},
            {label: 'üèòÔ∏è <strong>Densit√© de PDI par commune</strong><br /><table><tr><td style="text-align: center;"><img src="legend/communenationale_2_842600.png" /></td><td>84 - 260</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_2604411.png" /></td><td>260 - 441</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_4417542.png" /></td><td>441 - 754</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_75410743.png" /></td><td>754 - 1074</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_107423894.png" /></td><td>1074 - 2389</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_238933655.png" /></td><td>2389 - 3365</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_336560296.png" /></td><td>3365 - 6029</td></tr><tr><td style="text-align: center;"><img src="legend/communenationale_2_602997097.png" /></td><td>6029 - 9709</td></tr></table>', layer: layer_communenationale_2},
            {label: 'üìå <strong>Densit√© de PDI par arrondissement</strong><br /><table><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_231810.png" /></td><td>23 - 181</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_1813301.png" /></td><td>181 - 330</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_3305052.png" /></td><td>330 - 505</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_5057193.png" /></td><td>505 - 719</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_7199444.png" /></td><td>719 - 944</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_94414385.png" /></td><td>944 - 1438</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_143823326.png" /></td><td>1438 - 2332</td></tr><tr><td style="text-align: center;"><img src="legend/arrondissemeetude_1_233231757.png" /></td><td>2332 - 3175</td></tr></table>', layer: layer_arrondissemeetude_1},
            {label: "üó∫Ô∏è <strong>Fond de carte</strong>", layer: layer_OpenStreetMap_0, radioGroup: 'bm' },]
        var lay = L.control.layers.tree(null, overlaysTree,{
            //namedToggle: true,
            //selectorBack: false,
            //closedSymbol: '&#8862; &#x1f5c0;',
            //openedSymbol: '&#8863; &#x1f5c1;',
            //collapseAll: 'Collapse all',
            //expandAll: 'Expand all',
            collapsed: true,
        });
        lay.addTo(map);
        setBounds();
        function updateLayerVisibility() {
    var zoom = map.getZoom();

    if (zoom <= 7) {
        if (!map.hasLayer(layer_departementnational_4)) map.addLayer(layer_departementnational_4);
        map.removeLayer(layer_communenationale_2);
        map.removeLayer(layer_arrondissemeetude_1);
    } else if (zoom > 7 && zoom <= 8) {
        map.removeLayer(layer_departementnational_4);
        if (!map.hasLayer(layer_communenationale_2)) map.addLayer(layer_communenationale_2);
        map.removeLayer(layer_arrondissemeetude_1);
    } else if (zoom > 8) {
        map.removeLayer(layer_departementnational_4);
        map.removeLayer(layer_communenationale_2);
        if (!map.hasLayer(layer_arrondissemeetude_1)) map.addLayer(layer_arrondissemeetude_1);
    }
}
map.on("zoomend", updateLayerVisibility);
updateLayerVisibility();
 </script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>


const deptSelect = document.getElementById("select-dept");
const communeSelect = document.getElementById("select-commune");
const localiteSelect = document.getElementById("select-localite");

let data = json_basepdi_3.features;

// Extraire d√©partements et communes uniques
let departements = [...new Set(data.map(f => f.properties.D√©parteme))].sort();
let communes = [...new Set(data.map(f => f.properties.Localit√©))].sort();

// Remplir le menu d√©roulant
deptSelect.innerHTML = '<option value="">-- Tous les d√©partements --</option>' +
    departements.map(d => `<option value="${d}">${d}</option>`).join('');
communeSelect.innerHTML = '<option value="">-- Toutes les Localit√©s --</option>' +
    communes.map(c => `<option value="${c}">${c}</option>`).join('');

// √âcouteurs de changement
deptSelect.addEventListener("change", () => {
  const selectedDept = deptSelect.value;

  // Liste des communes du d√©partement
  const communes = [...new Set(data
    .filter(f => !selectedDept || f.properties.D√©parteme === selectedDept)
    .map(f => f.properties.Commune))].sort();

  communeSelect.innerHTML = '<option value="">-- Toutes les communes --</option>' +
    communes.map(c => `<option value="${c}">${c}</option>`).join('');

  localiteSelect.innerHTML = '<option value="">-- Toutes les localit√©s --</option>';

  updateStats();
});

communeSelect.addEventListener("change", () => {
  const selectedDept = deptSelect.value;
  const selectedCommune = communeSelect.value;

  // Liste des localit√©s de la commune (et du d√©partement si pr√©cis√©)
  const localites = [...new Set(data
    .filter(f =>
      (!selectedDept || f.properties.D√©parteme === selectedDept) &&
      (!selectedCommune || f.properties.Commune === selectedCommune)
    )
    .map(f => f.properties.Localit√©))].sort();

  localiteSelect.innerHTML = '<option value="">-- Toutes les Localit√©s --</option>' +
    localites.map(l => `<option value="${l}">${l}</option>`).join('');

  updateStats();
});

localiteSelect.addEventListener("change", updateStats);



let genderChart, causeChart, dateChart;

function updateStats() {
  let dept = deptSelect.value;
  let commune = communeSelect.value;
  let localite = localiteSelect.value;

  let filtered = data.filter(f =>
    (!dept || f.properties.D√©parteme === dept) &&
    (!commune || f.properties.Commune === commune) &&
    (!localite || f.properties.Localit√© === localite)
  );


  // Top 10 communes
 let topMap = {};
filtered.forEach(f => {
  let loc = f.properties.Localit√©;
  const nbPdi = Number(f.properties.Nb_PDI);
  topMap[loc] = (topMap[loc] || 0) + (isNaN(nbPdi) ? 0 : nbPdi);
});

  let top10 = Object.entries(topMap).sort((a,b) => b[1]-a[1]).slice(0, 10);

  document.getElementById("top-communes").innerHTML = `<strong>üèòÔ∏è Top 10 Localit√©s</strong><br>` +
    top10.map(([c,v], i) => `${i+1}. ${c} : ${v} PDI`).join("<br>");

  // Sexe
  let totalH = 0, totalF = 0;
  let causes = {}, dates = {};
  filtered.forEach(f => {
   totalH += Number(f.properties.Sexe_H) || 0;
totalF += Number(f.properties.Sexe_F) || 0;

    let cause = f.properties.Cause || "Inconnu";
    causes[cause] = (causes[cause] || 0) + 1;

    let d = f.properties.Date_arriv?.split(" ")[0] || "Non pr√©cis√©";
    dates[d] = (dates[d] || 0) + 1;
  });

  let genderData = {
    labels: ["Hommes", "Femmes"],
    datasets: [{
      label: "Nombre de PDI",
      data: [totalH, totalF],
      backgroundColor: ["#2196f3", "#f06292"]
    }]
  };

  let causeData = {
    labels: Object.keys(causes),
    datasets: [{
      label: "Nombre de localit√©s",
      data: Object.values(causes),
      backgroundColor: "#26a69a"
    }]
  };

  let dateData = {
    labels: Object.keys(dates).sort(),
    datasets: [{
      label: "Nombre de localit√©s",
      data: Object.keys(dates).sort().map(d => dates[d]),
      backgroundColor: "#ffa726"
    }]
  };

  if (genderChart) genderChart.destroy();
  if (causeChart) causeChart.destroy();
  if (dateChart) dateChart.destroy();

  genderChart = new Chart(document.getElementById("genderChart"), {
    type: "bar",
    data: genderData,
    options: { plugins: { title: { display: true, text: "R√©partition Hommes/Femmes", font: { size: 16 } } } }
  });

  causeChart = new Chart(document.getElementById("causeChart"), {
    type: "bar",
    data: causeData,
    options: { plugins: { title: { display: true, text: "R√©partition par Cause", font: { size: 16 } } } }
  });

 const ctx = document.getElementById("dateChart").getContext("2d");

const gradient = ctx.createLinearGradient(0, 0, 0, 200);
gradient.addColorStop(0, "#ffa726cc");
gradient.addColorStop(1, "#ffa72600");

dateChart = new Chart(ctx, {
  type: "line",
  data: {
    labels: Object.keys(dates).sort(),
    datasets: [{
      label: "Nombre de localit√©s",
      data: Object.keys(dates).sort().map(d => dates[d]),
      fill: true,
      backgroundColor: gradient,
      borderColor: "#fb8c00",
      tension: 0.3,
      pointBackgroundColor: "#fb8c00",
      pointRadius: 4,
    }]
  },
  options: {
    responsive: true,
    plugins: {
      title: {
        display: true,
        text: "üìÖ Dates d‚Äôarriv√©e des PDI",
        font: { size: 16 }
      },
      tooltip: {
        mode: "index",
        intersect: false
      },
      legend: {
        display: false
      }
    },
    scales: {
      x: {
        title: { display: true, text: "Date" },
        ticks: {
          callback: value => {
            const label = Object.keys(dates).sort()[value];
            return label.length === 10 ? label.slice(8,10) + "/" + label.slice(5,7) : label;
          }
        }
      },
      y: {
        title: { display: true, text: "Nombre de localit√©s" },
        beginAtZero: true
      }
    },
    animation: {
      duration: 1000,
      easing: 'easeOutQuart'
    }
  }
});

}

updateStats(); // lancer √† l‚Äôouverture
</script>
       <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const hoverZone = document.getElementById("stats-hover-zone");
  const statsPanel = document.getElementById("stats-panel");

  hoverZone.addEventListener("mouseenter", () => {
    statsPanel.classList.add("show");
  });

  statsPanel.addEventListener("mouseleave", () => {
    statsPanel.classList.remove("show");
  });

  // Analyse des donn√©es basepdi
  let data = json_basepdi_3.features;

  let topCommuneMap = {};
  let totalH = 0, totalF = 0;
  let causes = {};

  data.forEach(f => {
    let props = f.properties;
    totalH += props.Sexe_H || 0;
    totalF += props.Sexe_F || 0;

    causes[props.Cause] = (causes[props.Cause] || 0) + 1;

    let commune = props.Localit√©;
    topCommuneMap[commune] = (topCommuneMap[commune] || 0) + (props.Nb_PDI || 0);
  });

  let topCommune = Object.entries(topCommuneMap).sort((a, b) => b[1] - a[1])[0];
  document.getElementById("top-commune").innerHTML = `
    üèòÔ∏è <strong>Commune la plus touch√©e</strong> : ${topCommune[0]}<br>
    üë• <strong>PDI</strong> : ${topCommune[1]}
  `;

  new Chart(document.getElementById("genderChart"), {
    type: "pie",
    data: {
      labels: ["Hommes", "Femmes"],
      datasets: [{
        data: [totalH, totalF],
        backgroundColor: ["#4a90e2", "#f06292"]
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: "R√©partition Hommes / Femmes"
        }
      }
    }
  });

  new Chart(document.getElementById("causeChart"), {
    type: "bar",
    data: {
      labels: Object.keys(causes),
      datasets: [{
        label: "Nombre de localit√©s",
        data: Object.values(causes),
        backgroundColor: "#26a69a"
      }]
    },
    options: {
      plugins: {
        title: {
          display: true,
          text: "R√©partition par Cause de D√©placement"
        }
      }
    }
  });
</script>


    
<button id="toggle-stats-panel" title="Afficher les statistiques">üìä</button>

<script>
document.getElementById("toggle-stats-panel").addEventListener("click", function () {
  const panel = document.getElementById("stats-panel");
  panel.classList.toggle("show");
});
</script>

</body>
</html>
